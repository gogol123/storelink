"use strict";const n=require("electron"),u=require("node:os"),s=require("node:path");process.env.DIST_ELECTRON=s.join(__dirname,"..");process.env.DIST=s.join(process.env.DIST_ELECTRON,"../dist");process.env.PUBLIC=process.env.VITE_DEV_SERVER_URL?s.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;u.release().startsWith("6.1")&&n.app.disableHardwareAcceleration();process.platform==="win32"&&n.app.setAppUserModelId(n.app.getName());n.app.requestSingleInstanceLock()||(n.app.quit(),process.exit(0));let e=null,i=null,r=!1;const l=s.join(__dirname,"../preload/index.js"),c=process.env.VITE_DEV_SERVER_URL,p=s.join(process.env.DIST,"index.html");async function d(){e=new n.BrowserWindow({title:"Main window",icon:s.join(process.env.PUBLIC,"favicon.ico"),webPreferences:{preload:l,nodeIntegration:!0,contextIsolation:!1}}),process.env.VITE_DEV_SERVER_URL?(e.loadURL(c),e.webContents.openDevTools()):e.loadFile(p),e.webContents.on("did-finish-load",()=>{e==null||e.webContents.send("main-process-message",new Date().toLocaleString())}),e.webContents.setWindowOpenHandler(({url:o})=>(o.startsWith("https:")&&n.shell.openExternal(o),{action:"deny"})),e.on("close",o=>{r||(o.preventDefault(),e==null||e.hide())})}function f(){const o=s.join(process.env.PUBLIC,"favicon.ico");i=new n.Tray(o);const t=n.Menu.buildFromTemplate([{label:"Ouvrir",click:()=>{e==null||e.show()}},{label:"Statut (déconnecté)",enabled:!1},{label:"Quitter",click:()=>{r=!0,n.app.quit()}}]);i.setToolTip("StoreLink"),i.setContextMenu(t),i.on("click",()=>{e==null||e.show()})}n.app.whenReady().then(()=>{d(),f()});n.app.on("before-quit",()=>{r=!0});n.app.on("window-all-closed",()=>{e=null,process.platform});n.app.on("second-instance",()=>{e&&(e.isMinimized()&&e.restore(),e.focus())});n.app.on("activate",()=>{const o=n.BrowserWindow.getAllWindows();o.length?o[0].focus():d()});n.ipcMain.handle("open-win",(o,t)=>{const a=new n.BrowserWindow({webPreferences:{preload:l,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?a.loadURL(`${c}#${t}`):a.loadFile(p,{hash:t})});
